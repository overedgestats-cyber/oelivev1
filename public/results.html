<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Results · OverEdge</title>
  <meta name="description" content="W/L results for OverEdge Free Picks with success rate and details."/>
  <link rel="stylesheet" href="/style.css"/>

  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/overedge-logo-512.png">

  <style>
    /* ===== Base (dark) ===== */
    :root{
      --card-bg:#0e1420;
      --card-br:#2a2f3a;
      --text:#e5e7eb;
      --muted:rgba(229,231,235,.75);
      --shadow:0 6px 18px rgba(17,24,39,.25), inset 0 1px 0 rgba(255,255,255,.05);
    }
    body{color:var(--text)}
    .muted{opacity:.75}
    .muted-sm{opacity:.75;font-size:.92rem}
    .card{background:var(--card-bg);border:1px solid var(--card-br);border-radius:16px;box-shadow:var(--shadow);padding:14px 16px}

    /* ===== KPI GRID with explicit rows ===== */
    .kpi-grid{
      display:grid;gap:14px;margin:.5rem 0 1rem;
      grid-template-columns:repeat(6, minmax(140px,1fr));
      grid-template-areas:
        "total wins losses . . ."
        "mwin  mwin  mroi   mroi  . ."
        "ywin  ywin  yroi   yroi  . .";
    }
    .kpi{display:flex;flex-direction:column;justify-content:center}
    .kpi .label{font-size:.78rem;text-transform:uppercase;letter-spacing:.03em;opacity:.85;font-weight:800}
    .kpi .value{margin-top:4px;font-size:1.6rem;line-height:1;font-weight:900}

    .kpi.total  {grid-area:total}
    .kpi.wins   {grid-area:wins}
    .kpi.losses {grid-area:losses}
    .kpi.mwin   {grid-area:mwin}
    .kpi.mroi   {grid-area:mroi}
    .kpi.ywin   {grid-area:ywin}
    .kpi.yroi   {grid-area:yroi}

    /* Responsive: stack gracefully */
    @media (max-width: 1024px){
      .kpi-grid{
        grid-template-columns:repeat(2, minmax(140px,1fr));
        grid-template-areas:
          "total wins"
          "losses losses"
          "mwin  mwin"
          "mroi  mroi"
          "ywin  ywin"
          "yroi  yroi";
      }
    }

    /* ===== Extras row (same card style) ===== */
    .extras{display:grid;grid-template-columns:repeat(4,minmax(220px,1fr));gap:14px;margin:.5rem 0 1.25rem}
    @media (max-width: 1024px){ .extras{grid-template-columns:repeat(2,minmax(220px,1fr))} }
    @media (max-width: 560px) { .extras{grid-template-columns:1fr} }
    .extras .label{font-size:.78rem;text-transform:uppercase;letter-spacing:.03em;opacity:.85;font-weight:800}
    .extras .value{margin-top:2px;font-size:1.3rem;font-weight:900}

    /* ===== Simulator (card) ===== */
    .sim .row{display:flex;gap:.6rem;align-items:center;flex-wrap:wrap;margin:.35rem 0 .75rem}
    .sim input[type="number"], .sim select{
      padding:.45rem .6rem;border:1px solid var(--card-br);border-radius:8px;background:#0b1120;color:var(--text);min-width:120px
    }
    .pill{display:inline-block;padding:.22rem .55rem;border:1px solid var(--card-br);border-radius:999px;font-weight:800}

    /* ===== Tables ===== */
    .tbl{width:100%;border-collapse:separate;border-spacing:0}
    .tbl th,.tbl td{padding:.6rem .6rem;border-bottom:1px solid var(--card-br);vertical-align:top}
    .tbl th{text-align:left;font-weight:800;opacity:.85}

    /* WL pills */
    .wl-pill{display:inline-block;border-radius:999px;padding:.1rem .5rem;font-weight:800;font-size:.8rem}
    .wl-win{background:#063; color:#d1fae5;border:1px solid #064e3b}
    .wl-lose{background:#5a1111;color:#fee2e2;border:1px solid #991b1b}

    .date-head{margin-top:1.2rem;font-weight:800}
    .toolbar{display:flex;gap:.75rem;align-items:center;margin:.75rem 0 1.25rem}
    select{padding:.4rem .55rem;border:1px solid var(--card-br);border-radius:.5rem;background:#0b1120;color:var(--text)}

    /* ===== Month accordion (new) ===== */
    .months details{
      border:1px solid var(--card-br);
      background:var(--card-bg);
      border-radius:12px;
      box-shadow:var(--shadow);
      margin:.5rem 0 1rem;
      overflow:hidden;
    }
    .months summary{
      list-style:none;
      cursor:pointer;
      padding:12px 16px;
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:12px;
    }
    .months summary::-webkit-details-marker{display:none}
    .months summary::after{
      content:"▾";
      opacity:.8;
      transition:transform .15s ease;
    }
    .months details[open] summary::after{ transform:rotate(180deg); }
    .months .m-title{font-weight:800}
    .months .m-stats{opacity:.8; font-size:.92rem}
    .months .m-inner{padding:0 16px 14px}
  </style>

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-88C4MQ3EF8"></script>
  <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)} gtag('js',new Date()); gtag('config','G-88C4MQ3EF8');</script>
</head>
<script src="/pixel.js" defer></script>
<script src="/social.js" defer></script>

<body>
  <header class="site-header">
    <nav class="nav">
      <a class="logo brand" href="/" aria-label="OverEdge">
        <img class="brand-img" src="/img/overedge-logo.png" alt=""/><span class="sr-only">OverEdge</span>
      </a>
      <div class="links">
        <a href="/free-picks">Free Picks</a>
        <a href="/pro">Pro</a>
        <a href="/pricing">Pricing</a>
        <a href="/FAQ">FAQ</a>
        <a href="/results" aria-current="page">Results</a>
        <a href="/account">Account</a>
      </div>
      <div class="auth" style="display:flex;align-items:center;gap:.5rem">
        <span id="nav-plan" class="badge pill" style="display:none"></span>
        <a class="btn small secondary" href="/account">Sign In</a>
      </div>
    </nav>
  </header>

  <main class="section" style="max-width:1000px">
    <h1>Free Picks — Results</h1>
    <p class="muted">Transparent record of outcomes. Win% from settled picks (push excluded). ROI assumes flat 1u when odds are present.</p>

    <!-- ===== TOP KPIs (fixed 3 rows) ===== -->
    <div id="summary" class="kpi-grid">
      <div class="card kpi total"><div class="label">Total</div><div class="value" id="s-total">—</div></div>
      <div class="card kpi wins"><div class="label">Wins</div><div class="value" id="s-wins">—</div></div>
      <div class="card kpi losses"><div class="label">Losses</div><div class="value" id="s-losses">—</div></div>

      <div class="card kpi mwin"><div class="label">Monthly Win % (30d)</div><div class="value" id="s-mwin">—</div></div>
      <div class="card kpi mroi"><div class="label">Monthly ROI (1u, 30d)</div><div class="value" id="s-mroi">—</div></div>

      <div class="card kpi ywin"><div class="label">YTD Win %</div><div class="value" id="s-ywin">—</div></div>
      <div class="card kpi yroi"><div class="label">YTD ROI (1u)</div><div class="value" id="s-yroi">—</div></div>
    </div>

    <!-- ===== NEW: Current calendar month line (server-computed) ===== -->
    <section class="card" style="margin:.5rem 0 1.25rem">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
        <strong>Current month — Free Picks</strong>
        <span class="pill" id="cm-pill">…</span>
      </div>
      <div class="muted-sm" id="cm-line" style="margin-top:.35rem">Loading…</div>
    </section>

    <!-- ===== ROI Simulator (card) ===== -->
    <section class="card sim">
      <h2 style="margin:0 0 .35rem">ROI Simulator</h2>
      <p class="muted-sm">“If I staked a flat amount on every pick in the selected period…”</p>
      <div class="row">
        <label><strong>Stake per pick</strong></label>
        <input type="number" id="simStake" step="0.1" min="0" value="1">
        <label><strong>Range</strong></label>
        <select id="simRange">
          <option value="7">Last 7 days</option>
          <option value="30" selected>Last 30 days</option>
          <option value="all">All</option>
        </select>
        <button class="btn small" id="simRun" type="button">Run</button>
        <button class="btn secondary small" id="simExport" type="button">Export Bet Slip (CSV)</button>
      </div>
      <div class="out">
        <span class="pill">Picks: <strong id="simPicks">—</strong></span>
        <span class="pill">Wins: <strong id="simWins">—</strong></span>
        <span class="pill">Losses: <strong id="simLosses">—</strong></span>
        <span class="pill">Win%: <strong id="simWinrate">—</strong></span>
        <span class="pill">Stake: <strong id="simStakeSum">—</strong></span>
        <span class="pill">P/L (u): <strong id="simPnL">—</strong></span>
        <span class="pill">ROI: <strong id="simROI">—</strong></span>
      </div>
    </section>

    <!-- ===== Historical ROI by Market ===== -->
    <section class="card" style="padding:14px 16px; margin:.5rem 0 1.25rem">
      <h2 style="margin:0 0 .35rem">Historical ROI by Market</h2>
      <p class="muted-sm">Aggregated from the results on this page (flat 1u on picks with odds).</p>
      <table class="tbl" id="roiMarketTbl">
        <thead><tr><th>Market</th><th>Picks</th><th>Win%</th><th>ROI</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- ===== Month Picker ===== -->
    <div class="toolbar">
      <label for="monthSelect" class="muted-sm"><strong>Monthly view:</strong></label>
      <select id="monthSelect"></select>
      <span class="muted-sm" id="monthStats"></span>
    </div>

    <!-- ===== Monthly Lists (accordion container) ===== -->
    <div id="list">Loading…</div>
  </main>

  <footer class="site-footer">
    <span>© <span id="y"></span> OverEdge — Data beats gut</span>
    <div class="contact">
      <a href="mailto:overedgestats@gmail.com">overedgestats@gmail.com</a>
      &nbsp;·&nbsp;
      <a href="https://www.facebook.com/profile.php?id=61579190114778" target="_blank" rel="noopener">Facebook</a>
      &nbsp;·&nbsp;
      <a href="https://www.instagram.com/overedgefootball" target="_blank" rel="noopener">@overedgefootball</a>
    </div>
  </footer>

  <!-- Page logic -->
  <script>
    // footer year
    document.getElementById('y').textContent = new Date().getFullYear();

    // Current month line (server-computed via rpc)
    (async function(){
      try{
        const r = await fetch('/api/rpc?action=current-month-free-picks', { cache: 'no-store' });
        const j = await r.json();
        const pill = document.getElementById('cm-pill');
        const line = document.getElementById('cm-line');
        if (j?.ok) {
          if (pill) pill.textContent = `${j.winPct}%`;
          if (line) line.textContent = `${j.month} — Picks: ${j.picks} · Win%: ${j.winPct}% · ROI: ${j.roiPct}%`;
        } else {
          if (pill) pill.textContent = '—';
          if (line) line.textContent = 'Monthly stats unavailable';
        }
      } catch(e){
        const pill = document.getElementById('cm-pill');
        const line = document.getElementById('cm-line');
        if (pill) pill.textContent = '—';
        if (line) line.textContent = 'Monthly stats unavailable';
      }
    })();
  </script>
  <script src="/results.js" defer></script>
</body>
</html>
