<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Results · OverEdge</title>
  <meta name="description" content="W/L results for OverEdge Free Picks with success rate and details."/>
  <link rel="stylesheet" href="/style.css"/>

  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/overedge-logo-512.png">

  <style>
    .results-summary{display:flex;gap:1rem;flex-wrap:wrap;margin:.5rem 0 1rem}
    .results-summary .card{padding:.75rem 1rem}
    .wl-pill{display:inline-block;border-radius:999px;padding:.1rem .5rem;font-weight:800;font-size:.8rem}
    .wl-win{background:#ecfdf5;color:#065f46;border:1px solid #bbf7d0}
    .wl-lose{background:#fef2f2;color:#991b1b;border:1px solid #fecaca}
    .tbl{width:100%;border-collapse:separate;border-spacing:0}
    .tbl th,.tbl td{padding:.6rem .6rem;border-bottom:1px solid #e5e7eb;vertical-align:top}
    .tbl th{text-align:left;font-weight:800;opacity:.8}
    .date-head{margin-top:1.2rem;font-weight:800}
    .muted-sm{opacity:.75;font-size:.92rem}
  </style>

  <!-- Google tag -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-88C4MQ3EF8"></script>
  <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);} gtag('js',new Date()); gtag('config','G-88C4MQ3EF8');</script>
</head>
<body>
  <header class="site-header">
    <nav class="nav">
      <a class="logo brand" href="/" aria-label="OverEdge">
        <img class="brand-img" src="/img/overedge-logo.png" alt="" />
        <span class="sr-only">OverEdge</span>
      </a>
      <div class="links">
        <a href="/free-picks">Free Picks</a>
        <a href="/pro">Pro</a>
        <a href="/pricing">Pricing</a>
        <a href="/FAQ">FAQ</a>
        <a href="/results" aria-current="page">Results</a>
        <a href="/account">Account</a>
      </div>
      <div class="auth" style="display:flex;align-items:center;gap:.5rem">
        <span id="nav-plan" class="badge pill" style="display:none"></span>
        <a class="btn small secondary" href="/account">Sign In</a>
      </div>
    </nav>
  </header>

  <main class="section" style="max-width:1000px">
    <h1>Free Picks — Results</h1>
    <p class="muted">Transparent record of outcomes. We calculate Win% from settled picks (Push excluded). ROI assumes 1u flat staking when odds are present.</p>

    <div id="summary" class="results-summary">
      <div class="card"><div><strong>Total</strong></div><div id="s-total">—</div></div>
      <div class="card"><div><strong>Wins</strong></div><div id="s-wins">—</div></div>
      <div class="card"><div><strong>Losses</strong></div><div id="s-losses">—</div></div>
      <div class="card"><div><strong>Win %</strong></div><div id="s-winrate">—</div></div>
      <div class="card"><div><strong>ROI</strong></div><div id="s-roi">—</div></div>
    </div>

    <div id="list">Loading…</div>
  </main>

  <footer class="site-footer">
    <span>© <span id="y"></span> OverEdge — Data beats gut</span>
    <div class="contact">
      <a href="mailto:overedgestats@gmail.com">overedgestats@gmail.com</a>
      &nbsp;·&nbsp;
      <a href="https://www.facebook.com/profile.php?id=61579190114778" target="_blank" rel="noopener">Facebook</a>
      &nbsp;·&nbsp;
      <a href="https://www.instagram.com/overedgefootball" target="_blank" rel="noopener">@overedgefootball</a>
    </div>
  </footer>

  <script>
    document.getElementById('y').textContent=new Date().getFullYear();

    // --- helpers ---
    function ymd(d=new Date()){ return new Date(d).toISOString().slice(0,10); }
    function monthKey(dateStr){ return (dateStr||'').slice(0,7); } // "YYYY-MM"
    function monthLabel(key){
      const [y,m] = key.split('-').map(Number);
      const d = new Date(y, m-1, 1);
      return d.toLocaleDateString(undefined, { year:'numeric', month:'long' });
    }
    function wlPill(status){
      const s = String(status||'').toLowerCase();
      if (s === 'win') return '<span class="wl-pill wl-win">WIN</span>';
      if (s === 'loss' || s === 'lose') return '<span class="wl-pill wl-lose">LOSE</span>';
      return '—';
    }

    async function loadResults({from=null, to=null, limit=365} = {}){
      const q = new URLSearchParams();
      if (from) q.set('from', from);
      if (to)   q.set('to', to);
      q.set('limit', String(limit)); // grab up to a year
      const r = await fetch(`/api/rpc?action=free-picks-results&${q.toString()}`, { cache:'no-store' });
      if (!r.ok) throw new Error('Results fetch failed');
      return r.json();
    }

    function computeStats(picks){
      let wins=0, losses=0, stake=0, pnl=0;
      for (const p of picks){
        const s = String(p.status||'').toLowerCase();
        if (s === 'win') wins++;
        else if (s === 'lose' || s === 'loss') losses++;
        if (typeof p.odds === 'number'){
          stake += 1;
          if (s === 'win') pnl += (p.odds - 1);
          else if (s === 'lose' || s === 'loss') pnl -= 1;
        }
      }
      const settled = wins + losses;
      const winRate = settled ? Math.round((wins/settled)*100) : null;
      const roiPct  = stake ? Math.round((pnl/stake)*100) : null;
      return { wins, losses, settled, winRate, roiPct, stake, pnl };
    }

    function renderSummary(summary){
      const el = id => document.getElementById(id);
      const { total, wins, losses, winRate, roiPct } = summary || {};
      el('s-total').textContent   = total ?? '—';
      el('s-wins').textContent    = wins  ?? '—';
      el('s-losses').textContent  = losses?? '—';
      el('s-winrate').textContent = (winRate!=null ? `${winRate}%` : '—');
      el('s-roi').textContent     = (roiPct!=null ? `${roiPct}%` : '—');
    }

    function renderMonthly(monthMap, ytd){
      const host = document.getElementById('list');
      host.innerHTML = '';

      // YTD block
      const ytdBlock = document.createElement('section');
      ytdBlock.className = 'card';
      ytdBlock.style.padding = '.9rem 1rem';
      ytdBlock.innerHTML = `
        <div style="font-weight:800;margin-bottom:.35rem">Year-to-Date</div>
        <div class="muted-sm">
          Picks: <strong>${ytd.settled}</strong> &nbsp;·&nbsp;
          Wins: <strong>${ytd.wins}</strong> &nbsp;·&nbsp;
          Losses: <strong>${ytd.losses}</strong> &nbsp;·&nbsp;
          Win%: <strong>${ytd.winRate!=null?ytd.winRate+'%':'—'}</strong> &nbsp;·&nbsp;
          ROI: <strong>${ytd.roiPct!=null?ytd.roiPct+'%':'—'}</strong>
        </div>
      `;
      host.appendChild(ytdBlock);

      const months = Array.from(monthMap.keys()).sort().reverse();
      for (const key of months){
        const monthData = monthMap.get(key);
        const allPicks = monthData.days.flatMap(d => d.picks || []);
        const mStats = computeStats(allPicks);

        const wrap = document.createElement('section');
        wrap.innerHTML = `
          <div class="date-head" style="display:flex;justify-content:space-between;align-items:baseline">
            <span>${monthLabel(key)}</span>
            <span class="muted-sm">
              Picks: <strong>${mStats.settled}</strong> &nbsp;·&nbsp;
              Win%: <strong>${mStats.winRate!=null?mStats.winRate+'%':'—'}</strong> &nbsp;·&nbsp;
              ROI: <strong>${mStats.roiPct!=null?mStats.roiPct+'%':'—'}</strong>
            </span>
          </div>
        `;
        monthData.days.forEach(d => {
          const table = document.createElement('div');
          table.innerHTML = `
            <div class="muted-sm" style="margin:.35rem 0 .2rem;"><strong>${d.date}</strong></div>
            <table class="tbl">
              <thead>
                <tr>
                  <th>Match</th><th>Market</th><th>Odds</th><th>Result</th>
                </tr>
              </thead>
              <tbody>
                ${(d.picks||[]).map(p => `
                  <tr>
                    <td><strong>${p.home||''}</strong> vs <strong>${p.away||''}</strong>${p.finalScore?` <span class="muted-sm">(${p.finalScore})</span>`:''}</td>
                    <td><strong>${p.market||''}</strong></td>
                    <td>${(typeof p.odds==='number') ? Number(p.odds).toFixed(2) : '—'}</td>
                    <td>${wlPill(p.status)}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          `;
          wrap.appendChild(table);
        });

        host.appendChild(wrap);
      }
    }

    (async () => {
      try {
        const today = ymd();
        const { days, summary } = await loadResults({ to: today, limit: 365 });
        renderSummary(summary);

        const monthMap = new Map();
        for (const d of (days || [])){
          const key = monthKey(d.date);
          if (!monthMap.has(key)) monthMap.set(key, { days: [] });
          monthMap.get(key).days.push(d);
        }

        const ytdPicks = (days || []).flatMap(d => d.picks || []);
        const ytd = computeStats(ytdPicks);

        renderMonthly(monthMap, ytd);
      } catch (e) {
        document.getElementById('list').innerHTML = '<p>Could not load results right now.</p>';
        console.error(e);
      }
    })();
  </script>
</body>
</html>
