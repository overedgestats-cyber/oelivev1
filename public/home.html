<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>OverEdge — Data beats gut</title>
  <meta name="description" content="AI-powered football picks: Free Picks, Pro Board, and Hero Bet."/>
  <meta property="og:title" content="OverEdge — Data beats gut"/>
  <meta property="og:description" content="AI-powered football picks: Free Picks, Pro Board, and Hero Bet."/>
  <meta property="og:type" content="website"/>
  <link rel="stylesheet" href="/style.css"/>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-88C4MQ3EF8"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-88C4MQ3EF8');
  </script>
</head>
<body>
  <header class="site-header">
    <nav class="nav">
      <a class="logo" href="/">OverEdge</a>
      <div class="links">
        <a href="/free-picks">Free Picks</a>
        <a href="/pro">Pro</a>
        <a href="/pricing">Pricing</a>
        <a href="/FAQ">FAQ</a>
        <a href="/account">Account</a>
      </div>
      <!-- Global auth controls -->
      <div class="auth" style="display:flex;align-items:center;gap:.5rem">
        <span id="nav-plan" class="badge" style="display:none"></span>
        <button id="nav-auth" class="btn small secondary" type="button">Sign In</button>
      </div>
    </nav>
  </header>

  <main>
    <section class="hero">
      <h1>Data beats gut.</h1>
      <p>Daily football picks powered by real stats. Two free picks every day, plus the Pro Board and a Hero Bet for value hunters.</p>
      <p>
        <a class="btn" href="/free-picks">See Today’s Free Picks</a>
        <a class="btn secondary" href="/pricing">Go Pro</a>
      </p>
    </section>

    <section class="section">
      <h2>Today’s Free Picks (preview)</h2>
      <div id="home-free-picks"></div>
      <p><a class="btn small" href="/free-picks">View full details →</a></p>
    </section>

    <!-- Referral Program -->
    <section class="section">
      <h2>Referral Program</h2>
      <div class="card" style="padding:1rem;border:1px solid #eee;border-radius:14px">
        <p class="muted" style="margin-top:0">
          If you’re Pro for at least a month, share your link. When a friend subscribes Monthly, you get one free month.
        </p>

        <div id="ref-guest" style="display:none">
          <p><strong>Step 1:</strong> <a href="/account">Sign in with Google</a> to get your unique referral link.</p>
          <p><strong>Step 2:</strong> Share it anywhere—social, chats, or email.</p>
        </div>

        <div id="ref-user" style="display:none">
          <p><strong>Your referral link</strong></p>
          <div style="display:flex;gap:.5rem;flex-wrap:wrap">
            <input id="ref-link" type="text" readonly
                   style="flex:1;min-width:260px;padding:.65rem .75rem;border:1px solid var(--border);border-radius:12px"/>
            <button id="ref-copy" class="btn small" type="button">Copy</button>
          </div>
          <p class="muted" style="margin:.5rem 0 0">Tip: Share on Instagram, Facebook, or with your friends in chat.</p>
        </div>
      </div>
    </section>

    <section class="section">
      <h3>Why OverEdge?</h3>
      <ul>
        <li>Transparent reasoning (recent-form stats, not hype)</li>
        <li>Clear confidence % on every pick</li>
        <li>Fallback leagues when Europe’s top flights are quiet</li>
      </ul>
    </section>
  </main>

  <footer class="site-footer">
    <span>© <span id="y"></span> OverEdge — Data beats gut</span>
    <div class="contact">
      <a href="mailto:overedgestats@gmail.com">overedgestats@gmail.com</a>
      &nbsp;·&nbsp;
      <a href="https://www.facebook.com/profile.php?id=61579190114778" target="_blank" rel="noopener">Facebook</a>
      &nbsp;·&nbsp;
      <a href="https://www.instagram.com/overedgefootball" target="_blank" rel="noopener">@overedgefootball</a>
    </div>
  </footer>

  <script>
    // Year
    document.getElementById('y').textContent = new Date().getFullYear();

    // Preview two picks
    async function loadPreview() {
      const el = document.getElementById('home-free-picks');
      el.innerHTML = 'Loading…';
      try {
        const res = await fetch('/api/rpc?action=free-picks&tz=Europe/Sofia&minConf=75');
        const data = await res.json();
        if (!data.picks || data.picks.length === 0) {
          el.innerHTML = '<p>No confident picks available yet today.</p>';
          return;
        }
        el.innerHTML = data.picks.map(p => `
          <div class="card" style="margin:.75rem 0;padding:1rem;border:1px solid #eee;border-radius:12px">
            <div style="font-weight:600">${p.league}</div>
            <div style="opacity:.7">${p.matchTime} — ${p.home} vs ${p.away}</div>
            <div style="margin:.5rem 0">
              <span style="font-weight:600">${p.market}</span>
              <span style="margin-left:.5rem">(${p.confidencePct}% confidence)</span>
              ${p.odds ? `<span style="margin-left:1rem">Odds: ${p.odds}</span>` : ``}
            </div>
          </div>
        `).join('');
      } catch (e) {
        el.innerHTML = '<p>Could not load picks.</p>';
      }
    }
    document.addEventListener('DOMContentLoaded', loadPreview);
  </script>

  <!-- Shared navbar auth module -->
  <script type="module" src="/auth.js"></script>

  <!-- Referral UI module (initializes Firebase only if needed) -->
  <script type="module">
    import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";

    const refUser  = document.getElementById('ref-user');
    const refGuest = document.getElementById('ref-guest');
    const refInput = document.getElementById('ref-link');
    const refCopy  = document.getElementById('ref-copy');

    function copyToClipboard(el){
      try { el.select(); document.execCommand?.('copy'); } catch {}
      try { navigator.clipboard?.writeText(el.value); } catch {}
    }

    async function ensureFirebase() {
      if (!getApps().length) {
        const cfgRes = await fetch('/api/rpc?action=public-config');
        const cfg = (await cfgRes.json()).firebase || {};
        initializeApp(cfg);
      }
    }

    (async () => {
      await ensureFirebase();
      const authForReferral = getAuth();
      onAuthStateChanged(authForReferral, async (user) => {
        if (!user) {
          refGuest.style.display = 'block';
          refUser.style.display = 'none';
          return;
        }
        refGuest.style.display = 'none';
        refUser.style.display = 'block';

        try {
          const r = await fetch(`/api/rpc?action=get-ref-code&email=${encodeURIComponent(user.email)}`);
          const { link } = await r.json();
          refInput.value = link || (location.origin + '/?ref=' + encodeURIComponent(user.email));
        } catch {
          refInput.value = location.origin + '/?ref=' + encodeURIComponent(user.email);
        }
        refCopy?.addEventListener('click', () => copyToClipboard(refInput));
      });
    })();
  </script>

  <!-- Referral capture: store ?ref=CODE for 30 days -->
  <script>
    (function () {
      try {
        const u = new URL(location.href);
        const ref = u.searchParams.get('ref');
        if (ref) {
          document.cookie = `oe_ref=${encodeURIComponent(ref)}; Max-Age=${30*24*3600}; Path=/; SameSite=Lax`;
        }
      } catch {}
    })();
  </script>
</body>
</html>
