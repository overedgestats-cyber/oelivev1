<!doctype html>
<html lang="en">
  <!-- Meta Pixel Code -->
<script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '1135930111808538');
fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=1135930111808538&ev=PageView&noscript=1"
/></noscript>
<!-- End Meta Pixel Code -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>OverEdge â€” Data beats gut</title>
  <meta name="description" content="AI-powered football picks: Free Picks, Pro Board, and Hero Bet."/>
  <meta property="og:title" content="OverEdge â€” Data beats gut"/>
  <meta property="og:description" content="AI-powered football picks: Free Picks, Pro Board, and Hero Bet."/>
  <meta property="og:type" content="website"/>
  <link rel="stylesheet" href="/style.css"/>

  <!-- Favicons / icons -->
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/overedge-logo-512.png">

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-88C4MQ3EF8"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-88C4MQ3EF8');
  </script>

  <!-- Win-rate widget minimal styles -->
  <style>
    .win30.card{padding:14px 16px;border:1px solid rgba(0,0,0,.08);border-radius:14px}
    .win30 .w-row{display:flex;justify-content:space-between;align-items:center}
    .win30 .w-pill{background:#e6f7ec;border-radius:999px;padding:4px 10px;font-weight:700}
    .win30 .w-sub{opacity:.8;margin-top:6px;font-size:14px}
  </style>
</head>
<script defer src="/_vercel/speed-insights/script.js"></script>
<script src="/pixel.js" defer></script>
<script src="/social.js" defer></script>
<script src="/winrate.js" defer></script>

<body>
  <header class="site-header">
    <nav class="nav">
      <a class="logo brand" href="/" aria-label="OverEdge">
        <img class="brand-img" src="/img/overedge-logo.png" alt="" />
        <span class="sr-only">OverEdge</span>
      </a>

      <div class="links">
        <a href="/free-picks">Free Picks</a>
        <a href="/pro">Pro</a>
        <a href="/pricing">Pricing</a>
        <a href="/FAQ">FAQ</a>
        <a href="/results">Results</a>
        <a href="/account">Account</a>
      </div>
      <!-- Global auth controls -->
      <div class="auth" style="display:flex;align-items:center;gap:.5rem">
        <span id="nav-plan" class="badge" style="display:none"></span>
        <button id="nav-auth" class="btn small secondary" type="button">Sign In</button>
      </div>
    </nav>
  </header>

  <main>
    <section class="hero">
      <h1>Data beats gut.</h1>
      <p>Daily football picks powered by real stats. Two free picks every day, plus the Pro Board and a Hero Bet for value hunters.</p>
      <p>
        <a class="btn" href="/free-picks">See Todayâ€™s Free Picks</a>
        <a class="btn secondary" href="/pricing">Go Pro</a>
      </p>
    </section>

    <!-- NEW: Last 30 days win-rate widget -->
    <section class="section">
      <div class="win30 card" data-endpoint="/api/rpc?action=free-picks-results&limit=60">
        <div class="w-row">
          <strong>Last 30 days</strong>
          <span class="w-pill" id="win30-accuracy">â€¦</span>
        </div>
        <div class="w-sub" id="win30-stats">Loadingâ€¦</div>
      </div>
    </section>

    <section class="section">
      <h2>Todayâ€™s Free Picks (preview)</h2>
      <div id="home-free-picks"></div>
      <p style="margin-top:.6rem"><a class="btn small" href="/free-picks">View full details â†’</a></p>
    </section>

    <!-- NEW: Hero Bet teaser (blurred for Free users, reveals for Pro) -->
    <section class="section" id="hero-teaser" style="display:none">
      <h2>Hero Bet (teaser)</h2>
      <div class="card" style="padding:1rem;border-radius:12px;position:relative">
        <div id="hb-line" class="muted"></div>
        <div id="hb-pick" style="margin-top:.4rem;font-weight:800;font-size:1.1rem;filter:blur(6px)"></div>
        <div id="hb-why" class="muted" style="margin-top:.35rem;max-width:70ch"></div>
        <div id="hb-upgrade" style="margin-top:.6rem">
          <a class="btn small" href="/pricing">Go Pro to reveal</a>
        </div>
      </div>
    </section>
  </main>

  <!-- UPDATED FOOTER WITH TRUST + COOKIE LINK -->
  <footer class="site-footer">
    <span>Â© <span id="y"></span> OverEdge â€” Data beats gut</span>

    <div class="trust">
      <span class="tb"><i class="icon">ðŸ’³</i> Secured by Stripe</span>
      <span class="tb"><i class="icon">ðŸ‡ªðŸ‡º</i> GDPR Compliant</span>
      <span class="tb"><i class="icon">ðŸ”’</i> 256-bit SSL</span>
    </div>

    <a href="#" class="cookie-link" onclick="oeConsent.revoke();return false;">Cookie settings</a>

    <div class="contact" style="margin-top:6px">
      <a href="mailto:overedgestats@gmail.com">overedgestats@gmail.com</a>
      &nbsp;Â·&nbsp;
      <a href="https://www.facebook.com/profile.php?id=61579190114778" target="_blank" rel="noopener">Facebook</a>
      &nbsp;Â·&nbsp;
      <a href="https://www.instagram.com/overedgefootball" target="_blank" rel="noopener">@overedgefootball</a>
    </div>
  </footer>

  <script>
    // Year
    document.getElementById('y').textContent = new Date().getFullYear();

    function tzGuess(){
      try { return Intl.DateTimeFormat().resolvedOptions().timeZone || "Europe/Sofia"; }
      catch { return "Europe/Sofia"; }
    }

    function reasonSnippet(html){
      if (!html) return "";
      // Strip tags + collapse line breaks into spaces
      const txt = html.replace(/<br\s*\/?>/gi, " ").replace(/<\/?[^>]+(>|$)/g, "");
      const first = txt.split(/[.?!]\s/)[0];
      return first ? first.trim().replace(/\.$/,"") + "." : "";
    }

    function pickPreviewCard(p){
      const league = [p.country, p.league].filter(Boolean).join(" â€” ");
      const odds = (p.odds && !isNaN(Number(p.odds))) ? `<span class="badge odds" style="margin-left:.4rem">Odds ${Number(p.odds).toFixed(2)}</span>` : "";
      const snippet = reasonSnippet(p.reasoning || "");
      return `
        <div class="card" style="margin:.75rem 0;padding:1rem;border-radius:12px">
          <div style="font-weight:700">${league}</div>
          <div class="muted" style="margin:.15rem 0 .4rem">${p.matchTime} â€” <strong>${p.home}</strong> vs <strong>${p.away}</strong></div>
          <div style="display:flex;align-items:center;gap:.5rem;flex-wrap:wrap;margin:.2rem 0 .35rem">
            <strong>${p.market}</strong>
            <span class="badge pill conf">Confidence ${p.confidencePct}%</span>
            ${odds}
          </div>
          ${snippet ? `<div class="muted" style="font-size:.95rem">${snippet}</div>` : ""}
        </div>
      `;
    }

    // Preview two picks
    async function loadPreview() {
      const el = document.getElementById('home-free-picks');
      el.innerHTML = 'Loadingâ€¦';
      try {
        const res = await fetch(`/api/rpc?action=free-picks&tz=${encodeURIComponent(tzGuess())}&minConf=75`);
        const data = await res.json();
        const picks = Array.isArray(data?.picks) ? data.picks : [];
        if (!picks.length) {
          el.innerHTML = '<p class="muted">No confident picks available yet today.</p>';
          return;
        }
        el.innerHTML = picks.map(pickPreviewCard).join('');
      } catch (e) {
        el.innerHTML = '<p>Could not load picks.</p>';
      }
    }
    document.addEventListener('DOMContentLoaded', loadPreview);

    /* Win-rate widget: compute last 30 calendar days from RPC {days} */
    (async function(){
      const box = document.querySelector('.win30');
      if (!box) return;

      const url = box.getAttribute('data-endpoint');
      const accEl = document.getElementById('win30-accuracy');
      const statsEl = document.getElementById('win30-stats');

      const today = new Date();
      const start = new Date(today);
      start.setDate(start.getDate() - 29); // inclusive window: today-29 .. today

      function ymd(d){ return d.toISOString().slice(0,10); }
      const startYMD = ymd(start);
      const endYMD   = ymd(today);

      try {
        const r = await fetch(url, { cache: 'no-store' });
        const data = await r.json(); // { days, summary }
        const days = Array.isArray(data?.days) ? data.days : [];

        // Filter to last 30 calendar days (inclusive)
        const recent = days.filter(d => typeof d.date === 'string' && d.date >= startYMD && d.date <= endYMD);

        // Count wins/losses (exclude pending)
        let wins = 0, losses = 0;
        for (const d of recent) {
          const picks = Array.isArray(d.picks) ? d.picks : [];
          for (const p of picks) {
            const st = (p.status || '').toLowerCase();
            if (st === 'win') wins += 1;
            else if (st === 'loss' || st === 'lose') losses += 1;
          }
        }
        const total = wins + losses;
        const acc = total ? Math.round((wins / total) * 100) : 0;

        accEl.textContent = `${acc}%`;
        statsEl.textContent = `${wins} wins / ${losses} losses (${total} picks)`;
      } catch (e) {
        accEl.textContent = 'â€”';
        statsEl.textContent = 'No recent data';
      }
    })();

    /* === Hero Bet teaser loader (blur for Free, reveal for Pro) === */
    (async function loadHeroTeaser(){
      try{
        const r = await fetch(`/api/rpc?action=pro-pick&market=auto`, { cache: 'no-store' });
        const data = await r.json();
        const heroBet = data && data.heroBet;
        if (!heroBet) return;

        document.getElementById('hero-teaser').style.display = '';

        const line = `${heroBet.matchTime} â€” ${heroBet.home} vs ${heroBet.away} (${heroBet.country} â€” ${heroBet.league || 'League'})`;
        document.getElementById('hb-line').textContent = line;
        document.getElementById('hb-pick').textContent = `${heroBet.market}: ${heroBet.selection}`;

        // Reasoning: flatten simple <br> tags to spaces and strip other tags
        const why = String(heroBet.reasoning || '')
          .replace(/<br\s*\/?>/gi, ' ')
          .replace(/<\/?[^>]+(>|$)/g, '');
        document.getElementById('hb-why').textContent = why;
      }catch(e){}
    })();

    // Reveal the pick if the user is Pro (auth.js fills #nav-plan for Pro)
    (function(){
      function isPro(){
        const planEl = document.getElementById('nav-plan');
        if (!planEl) return false;
        const t = (planEl.textContent || '').trim();
        return !!t; // any non-empty plan label indicates Pro/override per your auth.js
      }
      function revealIfPro(){
        if (!isPro()) return;
        const pickEl = document.getElementById('hb-pick');
        if (pickEl) pickEl.style.filter = 'none';
        const upEl = document.getElementById('hb-upgrade');
        if (upEl) upEl.style.display = 'none';
      }
      document.addEventListener('DOMContentLoaded', revealIfPro);
      const plan = document.getElementById('nav-plan');
      if (plan){
        const obs = new MutationObserver(revealIfPro);
        obs.observe(plan, { childList:true, subtree:true, characterData:true });
      }
    })();
  </script>

  <!-- Shared navbar auth module -->
  <script type="module" src="/auth.js"></script>
</body>
</html>
