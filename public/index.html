<!doctype html>
<html lang="en">
  <!-- Meta Pixel Code -->
  <script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '1135930111808538');
  fbq('track', 'PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none"
  src="https://www.facebook.com/tr?id=1135930111808538&ev=PageView&noscript=1"/></noscript>
  <!-- End Meta Pixel Code -->

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>OverEdge â€” Free Picks</title>
  <meta name="description" content="Transparent football picks with clear confidence and reasoning."/>
  <link rel="stylesheet" href="/style.css"/>

  <!-- Favicons / icons -->
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/overedge-logo-512.png">

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-88C4MQ3EF8"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-88C4MQ3EF8');
  </script>

  <style>
    .lead { font-size: clamp(1.1rem, 1.7vw, 1.2rem); opacity:.8; margin-top:.25rem; }
    .muted-sm{opacity:.7;font-size:.95rem}
    .hb-blur{filter:blur(7px);-webkit-filter:blur(7px);pointer-events:none;user-select:none}
    .fixture-preview .meta{color:var(--muted);margin:.15rem 0 .15rem}

    /* hero */
    .hero{max-width:1100px;margin:0 auto;padding:32px 16px 8px;display:grid;gap:16px}
    .hero h1{font-size: clamp(1.8rem, 3.2vw, 2.6rem);margin:0}
    .hero p{max-width:72ch;opacity:.9}
    .cta-row{display:flex;gap:.75rem;flex-wrap:wrap}
    .cta-ghost{border:1px solid var(--line);background:transparent}

    /* performance band */
    .perf-band{
      max-width:1100px;margin:8px auto 24px;padding:12px 16px;border:1px solid var(--line);
      border-radius:14px;background:rgba(255,255,255,.02)
    }
    .perf-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
    .perf-item{display:flex;flex-direction:column;gap:4px}
    .perf-item .k{opacity:.7;font-size:.92rem}
    .perf-item .v{font-weight:800;font-size:1.1rem}

    /* two-col version for WR+ROI only */
    .perf-grid.two{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
    @media (max-width:640px){ .perf-grid.two{grid-template-columns:1fr} }

    .section-tight{max-width:900px;margin:0 auto}
    .benefits{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:10px}
    .benefit{border:1px solid var(--line);border-radius:12px;padding:14px;background:rgba(255,255,255,.02)}
    .trust{display:flex;gap:16px;flex-wrap:wrap;align-items:center;opacity:.85;font-size:.95rem}

    @media (max-width:820px){
      .perf-grid{grid-template-columns:1fr 1fr}
      .benefits{grid-template-columns:1fr}
    }
  </style>
</head>

<script defer src="/_vercel/speed-insights/script.js"></script>
<script>
  (function(){
    try{
      const u=new URL(location.href); const c=u.searchParams.get('fbclid');
      if(c) document.cookie="fbclid="+encodeURIComponent(c)+"; Max-Age="+60*60*24*90+"; Path=/; SameSite=Lax";
    }catch{}
  })();
</script>
<script src="/pixel.js" defer></script>
<script src="/social.js" defer></script>
<script src="/winrate.js?v=5" defer></script>

<body>
  <header class="site-header">
    <nav class="nav">
      <a class="logo brand" href="/" aria-label="OverEdge">
        <img class="brand-img" src="/img/overedge-logo.png" alt="" />
        <span class="sr-only">OverEdge</span>
      </a>

      <div class="links">
        <a href="/free-picks">Free Picks</a>
        <a href="/pro">Pro</a>
        <a href="/pricing">Pricing</a>
        <a href="/FAQ">FAQ</a>
        <a href="/results">Results</a>
        <a href="/account">Account</a>
      </div>
      <div class="auth" style="display:flex;align-items:center;gap:.5rem">
        <span id="nav-plan" class="badge pill" style="display:none"></span>
        <button id="nav-auth" class="btn small secondary" type="button">Sign In</button>
      </div>
    </nav>
  </header>

  <!-- HERO -->
  <section class="hero">
    <h1>Data beats gut.</h1>
    <p>Smart, stats-driven football picks. Two free selections every day, plus a Pro board with deep team stats and a high-value Hero Bet.</p>
    <div class="cta-row">
      <a class="btn" href="/free-picks">ðŸ”¥ Get Todayâ€™s Free Picks</a>
      <a class="btn cta-ghost" href="/pro">ðŸŽ¯ Explore Pro Features</a>
    </div>
  </section>

  <!-- PERFORMANCE (Win rate + ROI only) -->
  <section class="perf-band" aria-label="Performance last 30 days">
    <div class="perf-grid two">
      <div class="perf-item">
        <span class="k">Win rate (30 days)</span>
        <span class="v" id="wr30">â€”</span>
      </div>
      <div class="perf-item">
        <span class="k">ROI (1u, 30 days)</span>
        <span class="v" id="roi30">â€”</span>
      </div>
    </div>
    <div class="muted-sm" style="margin-top:6px">Verified daily via match results. <a href="/results">See full results â†’</a></div>
  </section>

  <main class="section section-tight">
    <h2>Todayâ€™s Free Picks (preview)</h2>
    <p class="lead">Open the Free Picks page to see the exact bets and reasoning.</p>

    <div id="home-free-picks" class="lead">Loadingâ€¦</div>

    <!-- Blurred Hero Bet teaser -->
    <section class="section" id="hero-teaser" style="display:none;padding-left:0;padding-right:0">
      <h2>Hero Bet (teaser)</h2>
      <div class="card" style="padding:1rem;border-radius:12px;position:relative">
        <div id="hb-content" class="hb-blur">
          <div id="hb-line" class="muted"></div>
          <div id="hb-pick" style="margin-top:.4rem;font-weight:800;font-size:1.1rem"></div>
          <div id="hb-why" class="muted" style="margin-top:.35rem;max-width:70ch"></div>
        </div>
        <div id="hb-upgrade" style="margin-top:.6rem">
          <a class="btn small" href="/pricing">Go Pro to reveal</a>
        </div>
      </div>
    </section>

    <p><a class="btn" href="/free-picks">View full details â†’</a></p>

    <!-- WHY GO PRO -->
    <section class="section" style="padding-left:0;padding-right:0">
      <h2>Why go Pro</h2>
      <div class="benefits">
        <div class="benefit">
          <div style="font-weight:700;margin-bottom:.25rem">ðŸ“Š Full stats board</div>
          <div class="muted-sm">Goals, corners, cards, shots, and trend filters over last 5/10/15 matches.</div>
        </div>
        <div class="benefit">
          <div style="font-weight:700;margin-bottom:.25rem">âš¡ Hero Bet (2.00â€“3.00)</div>
          <div class="muted-sm">One high-value pick daily with tight reasoning and odds.</div>
        </div>
        <div class="benefit">
          <div style="font-weight:700;margin-bottom:.25rem">ðŸ”Ž Pro Board & Filters</div>
          <div class="muted-sm">Explore all fixtures with powerful filters and confidence scoring.</div>
        </div>
      </div>
      <div class="cta-row" style="margin-top:12px">
        <a class="btn" href="/pricing">Upgrade to Pro</a>
      </div>
    </section>

    <!-- TRUST BAR -->
    <section class="section" style="padding-left:0;padding-right:0">
      <div class="trust">
        <span>Trusted by football fans</span>
        <span>â€¢</span>
        <span>Stripe secure checkout</span>
        <span>â€¢</span>
        <a href="/results">Transparent daily records</a>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <span>Â© <span id="y"></span> OverEdge â€” Data beats gut</span>
    <div class="contact">
      <a href="mailto:overedgestats@gmail.com">overedgestats@gmail.com</a>
      &nbsp;Â·&nbsp;
      <a href="https://www.facebook.com/profile.php?id=61579190114778" target="_blank" rel="noopener">Facebook</a>
      &nbsp;Â·&nbsp;
      <a href="https://www.instagram.com/overedgefootball" target="_blank" rel="noopener">@overedgefootball</a>
    </div>
  </footer>

  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    function tzGuess(){
      try { return Intl.DateTimeFormat().resolvedOptions().timeZone || "Europe/Sofia"; }
      catch { return "Europe/Sofia"; }
    }

    // preview-only cards
    function pickPreviewCard(p){
      const league = [p.country, p.league].filter(Boolean).join(" â€” ");
      return `
        <div class="card fixture-preview" style="margin:.75rem 0;padding:1rem;border-radius:12px">
          <div style="font-weight:700">${league}</div>
          <div class="meta">${p.matchTime || ''} â€” <strong>${p.home}</strong> vs <strong>${p.away}</strong></div>
        </div>
      `;
    }

    async function loadPreview() {
      const el = document.getElementById('home-free-picks');
      if (!el) return;
      el.textContent = 'Loadingâ€¦';
      try {
        const res = await fetch(`/api/rpc?action=free-picks&tz=${encodeURIComponent(tzGuess())}&minConf=75`);
        const data = await res.json();
        const picks = Array.isArray(data?.picks) ? data.picks : [];
        if (!picks.length) {
          el.innerHTML = '<p class="lead">No confident picks available yet today.</p>';
          return;
        }
        el.innerHTML = picks.map(pickPreviewCard).join('');
      } catch (e) {
        el.innerHTML = '<p class="lead">Could not load picks.</p>';
      }
    }
    document.addEventListener('DOMContentLoaded', loadPreview);

    /* === Hero Bet teaser loader (blur for Free, reveal for Pro) === */
    (async function loadHeroTeaser(){
      try{
        const r = await fetch(`/api/rpc?action=pro-pick&market=auto`, { cache: 'no-store' });
        const data = await r.json();
        const heroBet = data && data.heroBet;
        if (!heroBet) return;

        document.getElementById('hero-teaser').style.display = '';

        const line = `${heroBet.matchTime} â€” ${heroBet.home} vs ${heroBet.away} (${heroBet.country} â€” ${heroBet.league || 'League'})`;
        document.getElementById('hb-line').textContent = line;
        document.getElementById('hb-pick').textContent = `${heroBet.market}: ${heroBet.selection}`;

        const why = String(heroBet.reasoning || '')
          .replace(/<br\s*\/?>/gi, ' ')
          .replace(/<\/?[^>]+(>|$)/g, '');
        document.getElementById('hb-why').textContent = why;
      }catch(e){}
    })();

    // Reveal if Pro (remove blur)
    (function(){
      function isPro(){
        const planEl = document.getElementById('nav-plan');
        if (!planEl) return false;
        const t = (planEl.textContent || '').trim();
        return !!t && t.toLowerCase() !== 'free';
      }
      function revealIfPro(){
        if (!isPro()) return;
        const content = document.getElementById('hb-content');
        if (content) content.classList.remove('hb-blur');
        const upEl = document.getElementById('hb-upgrade');
        if (upEl) upEl.style.display = 'none';
      }
      document.addEventListener('DOMContentLoaded', revealIfPro);
      const plan = document.getElementById('nav-plan');
      if (plan){
        const obs = new MutationObserver(revealIfPro);
        obs.observe(plan, { childList:true, subtree:true, characterData:true });
      }
    })();
  </script>

 <!-- Perf band: WR/ROI from last 30 days (RPC â†’ /results.js â†’ /results HTML) -->
<script>
(async function loadPerf30(){
  const wrEl = document.getElementById('wr30');
  const roiEl = document.getElementById('roi30');
  if (!wrEl || !roiEl) return;

  // ---------- helpers ----------
  const asDate = (s) => {
    if (!s) return null;
    if (/^\d{4}-\d{2}-\d{2}$/.test(s)) return new Date(s + "T12:00:00");
    const m = s.match(/^(\d{2})\.(\d{2})\.(\d{4})$/); // DD.MM.YYYY
    if (m) return new Date(`${m[3]}-${m[2]}-${m[1]}T12:00:00`);
    const d = new Date(s);
    return isNaN(d) ? null : d;
  };
  const within30 = (d) => {
    if (!(d instanceof Date) || isNaN(d)) return false;
    const now = new Date();
    const from = new Date(now); from.setDate(now.getDate() - 30);
    return d >= from && d <= now;
  };
  function compute(items){
    const last30 = items.filter(x => within30(asDate(x.date)));
    const total = last30.length;
    if (!total) return { wr: 0, roi: 0 };
    let wins = 0, profit = 0;
    for (const x of last30) {
      const res  = String(x.result || "").toUpperCase();
      const odds = Number(x.odds || 0);
      if (res === "WIN") { wins += 1; if (odds > 1) profit += (odds - 1); }
      else if (res === "LOSS" || res === "LOST") { profit -= 1; }
      // PUSH/VOID => 0
    }
    return { wr: (wins/total)*100, roi: (profit/total)*100 };
  }

  // ---------- source #1: RPC ----------
  async function fromRPC(){
    try{
      const r = await fetch('/api/rpc?action=free-picks-results', { cache: 'no-store' });
      const data = await r.json();
      const arr = Array.isArray(data?.results) ? data.results : [];
      return arr.map(it => ({
        date:  it.date || it.matchDate || it.createdAt || "",
        odds:  it.odds || it.price || it.o || "",
        result: (it.result || it.outcome || "").toString()
      }));
    }catch{ return []; }
  }

  // ---------- source #2: parse /results.js (static builder) ----------
  async function fromResultsJS(){
    try{
      const js = await (await fetch('/results.js', { cache: 'no-store' })).text();

      // try to extract JSON if you store it like const RESULTS=[...];
      const jsonVar = js.match(/RESULTS\s*=\s*(\[[\s\S]*?\]);?/);
      if (jsonVar) {
        try {
          const arr = JSON.parse(jsonVar[1]);
          return arr.map(it => ({
            date:  it.date || it.d || "",
            odds:  it.odds || it.o || "",
            result: it.result || it.r || ""
          }));
        } catch {}
      }

      // generic parser: walk through lines; remember last date header; parse rows
      const lines = js.split(/\n|\r/);
      let currentDate = null;
      const out = [];
      const dateRe1 = /^\s*(\d{4}-\d{2}-\d{2})\b/;   // 2025-10-07
      const dateRe2 = /^\s*(\d{2}\.\d{2}\.\d{4})\b/; // 07.10.2025
      const resRe   = /\b(WIN|LOSS|LOST|PUSH|VOID)\b/i;
      const oddsRe  = /odds?\s*([0-9]+(?:\.[0-9]+)?)/i;

      for (let raw of lines) {
        const line = raw.replace(/[`'"<>]/g, '').trim();
        if (!line) continue;
        let m;
        if ((m = line.match(dateRe1))) { currentDate = m[1]; continue; }
        if ((m = line.match(dateRe2))) { currentDate = m[1]; continue; }
        if (line.toLowerCase().includes(' vs ') && resRe.test(line)) {
          const resM  = line.match(resRe);
          const oddsM = line.match(oddsRe);
          out.push({ date: currentDate, odds: oddsM ? oddsM[1] : "", result: resM[1].toUpperCase() });
        }
      }
      return out;
    }catch{ return []; }
  }

  // ---------- source #3: scrape /results HTML ----------
  async function fromResultsHTML(){
    try{
      const html = await (await fetch('/results', { cache: 'no-store' })).text();
      const text = html.replace(/<\/?[^>]+>/g, '\n'); // drop tags to keep lines
      const lines = text.split(/\n|\r/);
      let currentDate = null;
      const out = [];
      const dateRe1 = /^\s*(\d{4}-\d{2}-\d{2})\b/;
      const dateRe2 = /^\s*(\d{2}\.\d{2}\.\d{4})\b/;
      const resRe   = /\b(WIN|LOSS|LOST|PUSH|VOID)\b/i;
      const oddsRe  = /odds?\s*([0-9]+(?:\.[0-9]+)?)/i;

      for (let raw of lines) {
        const line = raw.trim();
        if (!line) continue;
        let m;
        if ((m = line.match(dateRe1))) { currentDate = m[1]; continue; }
        if ((m = line.match(dateRe2))) { currentDate = m[1]; continue; }
        if (line.toLowerCase().includes(' vs ') && resRe.test(line)) {
          const resM  = line.match(resRe);
          const oddsM = line.match(oddsRe);
          out.push({ date: currentDate, odds: oddsM ? oddsM[1] : "", result: resM[1].toUpperCase() });
        }
      }
      return out;
    }catch{ return []; }
  }

  // try in order
  let items = await fromRPC();
  if (!items.length) items = await fromResultsJS();
  if (!items.length) items = await fromResultsHTML();

  const { wr, roi } = compute(items);
  wrEl.textContent  = `${wr.toFixed(1)}%`;
  roiEl.textContent = `${roi.toFixed(1)}%`;
})();
</script>
