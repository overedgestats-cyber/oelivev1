<!doctype html>
<html lang="en">
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-88C4MQ3EF8"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-88C4MQ3EF8');
</script>
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Account · OverEdge</title>

  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="alternate icon" href="/og.png" type="image/png">
  <link rel="stylesheet" href="/style.css"/>

  <style>
    .grid2 { display:grid; grid-template-columns: 160px 1fr; gap:10px 18px; align-items:center; }
    .chip { display:inline-block; padding:2px 8px; border-radius:999px; background:#132815; border:1px solid #24522b; font-size:.85rem; }
    .row label { opacity:.75; }
  </style>
</head>
<body>
<header>
  <nav>
    <a href="/home.html">Home</a>
    <a href="/free-picks.html">Free Picks</a>
    <a href="/pro.html">Pro</a>
    <a href="/pricing.html">Pricing</a>
    <a href="/about.html">About</a>
    <a href="/FAQ.html">FAQ</a>

    <span style="float:right; line-height:1.2; text-align:right">
      <button id="loginBtn" class="btn">Sign in</button>

      <span id="userBox" style="display:none">
        <small id="userEmail"></small><br/>
        <a id="accountLink" href="/account.html">Account</a>
      </span>

      <button id="logoutBtn" class="btn" hidden>Sign out</button>
    </span>
  </nav>
</header>

<main style="max-width:800px;margin:0 auto">
  <h1>Account</h1>
  <div class="card" id="acctCard">Loading…</div>
</main>

<footer>
  © OverEdge ·
  <a href="mailto:overedgestats@gmail.com">overedgestats@gmail.com</a> ·
  <a href="https://www.facebook.com/profile.php?id=61579190114778#" target="_blank" rel="noopener noreferrer">Facebook</a> ·
  <a href="https://www.instagram.com/overedgefootball?igsh=MXJsb3U5ajR0cXR0bw%3D%3D&utm_source=qr" target="_blank" rel="noopener noreferrer">Instagram</a>
</footer>

<!-- Firebase + app wiring -->
<script src="/firebase-config.js"></script>
<script type="module" src="/firebase-init.js"></script>
<script type="module" src="/app.js?v=10"></script>

<!-- Account page logic -->
<script type="module">
  import { getToken, auth, signIn } from "/firebase-init.js";

  const apiBase = location.origin;
  const card = document.getElementById("acctCard");

  function fmtDate(iso) {
    if (!iso) return "—";
    const d = new Date(iso);
    if (isNaN(+d)) return "—";
    return d.toLocaleString();
  }

  async function loadAccount() {
    try {
      const user = auth.currentUser;
      if (!user) {
        card.innerHTML = 'Please sign in to view your account. <a class="btn" id="goSignIn">Sign in</a>';
        document.getElementById("goSignIn")?.addEventListener("click", (e) => {
          e.preventDefault(); signIn();
        });
        return;
      }

      const token = await getToken();
      const r = await fetch(`${apiBase}/api/account/info`, {
        headers: { Authorization: "Bearer " + token }
      });
      const raw = await r.text(); let data = null; try { data = JSON.parse(raw); } catch {}
      if (!r.ok) {
        card.innerHTML = `<div class="card">Server error: ${(data && (data.message || data.error)) || raw.slice(0,180)}</div>`;
        return;
      }

      const plan = data.plan || {};
      const tierLabel  = (plan.tier && plan.tier !== "Free") ? plan.tier : "Free";
      const statusChip = (plan.status === "active" || data.proActive) ? '<span class="chip">Pro active</span>' : '';
      const next       = (plan.status === "active") ? fmtDate(data.nextRenewal) : "—";

      card.innerHTML = `
        <div class="grid2">
          <div class="row"><label>Email</label></div>        <div>${data.email || "—"}</div>
          <div class="row"><label>Last login</label></div>   <div>${fmtDate(data.lastLogin)}</div>
          <div class="row"><label>Plan</label></div>         <div>${tierLabel} ${statusChip}</div>
          <div class="row"><label>Status</label></div>       <div>${plan.status || "—"}</div>
          <div class="row"><label>Next renewal</label></div> <div>${next}</div>
        </div>
      `;
    } catch (e) {
      card.innerHTML = `<div class="card">Error: ${e.message}</div>`;
    }
  }

  document.addEventListener("DOMContentLoaded", loadAccount);
  auth.onAuthStateChanged(loadAccount);
</script>
</body>
</html>
