<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Pro Board ¬∑ OverEdge</title>
  <meta name="description" content="Hero Bet of the Day and full stats board for deeper picks."/>
  <link rel="stylesheet" href="/style.css"/>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-88C4MQ3EF8"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-88C4MQ3EF8');
  </script>
</head>
<body>
  <header class="site-header">
    <nav class="nav">
      <a class="logo" href="/">OverEdge</a>
      <div class="links">
        <a href="/free-picks">Free Picks</a>
        <a href="/pro" aria-current="page">Pro</a>
        <a href="/pricing">Pricing</a>
        <a href="/FAQ">FAQ</a>
        <a href="/account">Account</a>
      </div>

      <!-- üîΩ Added: global auth controls in the navbar -->
      <div class="auth" style="display:flex;align-items:center;gap:.5rem">
        <span id="nav-plan" class="badge" style="display:none"></span>
        <button id="nav-auth" class="btn small secondary" type="button">Sign In</button>
      </div>
      <!-- üîº End added -->
    </nav>
  </header>

  <main>
    <!-- LOCKED VIEW -->
    <section id="locked" class="section" style="display:none">
      <h1>Pro is locked</h1>
      <p class="muted">Sign in with Google and subscribe to unlock the Pro Board and Hero Bet.</p>
      <p>
        <a class="btn" href="/account">Sign in</a>
        <a class="btn secondary" href="/pricing">Get Pro</a>
      </p>
    </section>

    <!-- PRO CONTENT -->
    <section id="proContent" class="section" style="display:none">
      <h1>Pro Board</h1>
      <p class="muted">Hero Bet of the Day and full team stats (5/10/15). Filters for Over/Under, BTTS, Cards, Corners, Shots, Goals.</p>

      <section class="section">
        <h2>Hero Bet of the Day</h2>
        <div id="hero-bet" class="card" style="padding:1rem;border:1px solid #eee;border-radius:12px">Loading‚Ä¶</div>
        <p class="muted" style="margin-top:.5rem">If you see ‚Äúcoming soon‚Äù, the endpoint isn‚Äôt live yet.</p>
      </section>

      <section class="section">
        <h3>Pro Features</h3>
        <ul>
          <li>Full team stat filters (last 5/10/15)</li>
          <li>Over/Under, BTTS, Corners, Cards, Shots, Goals</li>
          <li>Strict FT markets for odds</li>
          <li>Reasoning & confidence % on suggestions</li>
        </ul>
      </section>
    </section>
  </main>

  <footer class="site-footer">
    <span>¬© <span id="y"></span> OverEdge ‚Äî Data beats gut</span>
  </footer>

  <!-- Firebase + gating -->
  <script type="module">
    import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";

    document.getElementById('y').textContent = new Date().getFullYear();

    const locked = document.getElementById('locked');
    const proContent = document.getElementById('proContent');
    const heroEl = document.getElementById('hero-bet');

    let auth = null;

    async function initFirebase() {
      const cfg = await fetch('/api/rpc?action=public-config').then(r => r.json()).then(d => d.firebase || {});
      if (!getApps().length) initializeApp(cfg);
      auth = getAuth();
      return auth;
    }

    async function verifyStripe(email) {
      try {
        const res = await fetch(`/api/rpc?action=verify-sub&email=${encodeURIComponent(email)}`);
        if (!res.ok) throw new Error('verify failed');
        return await res.json(); // { pro, plan, status }
      } catch {
        return { pro: false, plan: null, status: 'unknown' };
      }
    }

    async function loadHeroBet() {
      try {
        const res = await fetch('/api/rpc?action=pro-pick');
        if (!res.ok) { heroEl.innerHTML = '<p>Coming soon. (API endpoint not enabled yet.)</p>'; return; }
        const data = await res.json();
        if (!data || !data.heroBet) { heroEl.innerHTML = '<p>No Hero Bet available right now.</p>'; return; }
        const p = data.heroBet;
        heroEl.innerHTML = `
          <div style="font-weight:600">${p.league || ''}</div>
          <div style="opacity:.7">${p.matchTime || ''} ‚Äî ${p.selection || ''}</div>
          <div style="margin:.5rem 0">
            <span>Odds: ${p.odds ?? '-'}</span>
            <span style="margin-left:1rem">Confidence: ${p.confidencePct ?? '-'}%</span>
          </div>
          <div style="font-size:.95rem">${p.reasoning || ''}</div>
        `;
      } catch {
        heroEl.innerHTML = '<p>Could not load Hero Bet.</p>';
      }
    }

    (async () => {
      await initFirebase();
      onAuthStateChanged(auth, async (user) => {
        if (!user) {
          locked.style.display = 'block';
          proContent.style.display = 'none';
          return;
        }
        const sub = await verifyStripe(user.email);
        if (!sub.pro) {
          locked.style.display = 'block';
          proContent.style.display = 'none';
          return;
        }
        locked.style.display = 'none';
        proContent.style.display = 'block';
        loadHeroBet();
      });
    })();
  </script>

  <!-- üîΩ Added: shared navbar auth module (powers the Sign In/Out button globally) -->
  <script type="module" src="/auth.js"></script>
  <!-- üîº End added -->
</body>
</html>
