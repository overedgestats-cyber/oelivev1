<!doctype html>
<html lang="en">
  <!-- Meta Pixel Code -->
<script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '1135930111808538');
fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=1135930111808538&ev=PageView&noscript=1"
/></noscript>
<!-- End Meta Pixel Code -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Free Picks · OverEdge</title>
  <meta name="description" content="Two highest-confidence Over/Under 2.5 Goals selections each day."/>
  <link rel="stylesheet" href="/style.css"/>

  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/overedge-logo-512.png">

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-88C4MQ3EF8"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-88C4MQ3EF8');
  </script>

  <!-- Calculator styles (scoped) -->
  <style>
    #roi-calc .calc-grid{
      display:grid;gap:10px;
      grid-template-columns:repeat(4,minmax(160px,1fr));
      align-items:end;margin-bottom:.6rem
    }
    @media (max-width:920px){ #roi-calc .calc-grid{grid-template-columns:1fr 1fr} }
    @media (max-width:560px){ #roi-calc .calc-grid{grid-template-columns:1fr} }

    #roi-calc label{font-weight:700;opacity:.9}
    #roi-calc input[type="number"]{
      width:100%;padding:.5rem .6rem;border:1px solid var(--line);
      border-radius:10px;background:rgba(255,255,255,.02);color:var(--text)
    }
    #roi-calc .calc-row{
      display:flex;justify-content:space-between;gap:10px;align-items:center;
      border:1px solid var(--line);border-radius:12px;padding:10px 12px;margin:.35rem 0;
      background:rgba(255,255,255,.02)
    }
    #roi-calc .pill{
      display:inline-block;border:1px solid var(--line);
      border-radius:999px;padding:.2rem .55rem;font-weight:800;margin-left:6px
    }
    #roi-calc .muted-sm{opacity:.75;font-size:.92rem}
    #roi-calc .totals{display:flex;gap:8px;flex-wrap:wrap;margin-top:.6rem}
  </style>
</head>
<script defer src="/_vercel/speed-insights/script.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  try{ fbq('track','ViewContent',{content_category:'free_picks'}); }catch(e){}
});
</script>
<script> if (typeof fbq==='function') fbq('track','ViewContent',{content_name:'Free Picks'}); </script>
<script src="/pixel.js" defer></script>
<script src="/social.js" defer></script>
<script src="/betslip.js" defer></script>

<body>
<header class="site-header">
  <nav class="nav">
    <a class="logo brand" href="/" aria-label="OverEdge">
      <img class="brand-img" src="/img/overedge-logo.png" alt="">
      <span class="sr-only">OverEdge</span>
    </a>
    <div class="links">
      <a href="/free-picks" aria-current="page">Free Picks</a>
      <a href="/pro">Pro</a>
      <a href="/pricing">Pricing</a>
      <a href="/FAQ">FAQ</a>
      <a href="/results">Results</a>
      <a href="/account">Account</a>
    </div>
    <div class="auth" style="display:flex;align-items:center;gap:.5rem">
      <span id="nav-plan" class="badge pill" style="display:none"></span>
      <a class="btn small secondary" href="/account">Sign In</a>
    </div>
  </nav>
</header>

<main>
  <section class="section">
    <h1 style="display:flex;align-items:center;justify-content:space-between;gap:.5rem;flex-wrap:wrap">
      Today’s Free Picks
      <button id="exportFree" class="btn small" type="button">Copy Bet Slip</button>
    </h1>
    <p class="muted">Updated daily. We post the two highest-confidence Over/Under 2.5 selections — backed by precise research and data, not gut.</p>

    <div id="list">Loading…</div>

    <!-- ===== Potential Winnings / 3-field ROI Calculator ===== -->
    <section class="card" id="roi-calc" style="margin-top:12px; display:none; padding:14px 16px;border-radius:14px">
      <h2 style="margin:0 0 .35rem">Potential Winnings</h2>
      <p class="muted-sm">Based on today’s free picks (odds required).</p>

      <div class="calc-grid">
        <div>
          <label for="stake1">1st game (single)</label>
          <input id="stake1" type="number" step="0.1" min="0" value="1" />
        </div>
        <div>
          <label for="stake2">2nd game (single)</label>
          <input id="stake2" type="number" step="0.1" min="0" value="1" />
        </div>
        <div>
          <label for="stakeParlay">2-leg parlay</label>
          <input id="stakeParlay" type="number" step="0.1" min="0" value="1" />
        </div>
        <div>
          <button id="stakeReset" class="btn secondary small" type="button" style="width:100%">Reset</button>
        </div>
      </div>

      <div id="calcBody">
        <div class="muted-sm">Waiting for today’s picks…</div>
      </div>

      <div id="calcFoot" class="totals muted-sm"></div>
    </section>
    <!-- ===== /Calculator ===== -->
  </section>
</main>

<footer class="site-footer">
  <span>© <span id="y"></span> OverEdge — Data beats gut</span>
  <div class="contact">
    <a href="mailto:overedgestats@gmail.com">overedgestats@gmail.com</a>
    &nbsp;·&nbsp;
    <a href="https://www.facebook.com/profile.php?id=61579190114778" target="_blank" rel="noopener">Facebook</a>
    &nbsp;·&nbsp;
    <a href="https://www.instagram.com/overedgefootball" target="_blank" rel="noopener">@overedgefootball</a>
  </div>
</footer>

<script>
  document.getElementById('y').textContent = new Date().getFullYear();

  // keep last loaded picks for export + calculator
  let LAST_FREE_PICKS = [];

  function tzGuess(){
    try { return Intl.DateTimeFormat().resolvedOptions().timeZone || "Europe/Sofia"; }
    catch { return "Europe/Sofia"; }
  }

  function pickCard(p){
    const league = [p.country, p.league].filter(Boolean).join(" — ");
    const pickClass = (p.market || "").toLowerCase().startsWith("over") ? "over" : "under";
    const odds = (p.odds && !isNaN(Number(p.odds))) ? `<span class="badge odds">Odds ${Number(p.odds).toFixed(2)}</span>` : "";
    const trend = p.trend ? `<div class="muted-sm" style="margin-top:.25rem"><strong>Trend:</strong> ${p.trend}</div>` : "";

    return `
      <div class="pick-card ${pickClass}">
        <div class="league-line">${league}</div>
        <div class="muted-sm" style="margin:.15rem 0 .35rem">
          ${p.matchTime} — <strong>${p.home}</strong> vs <strong>${p.away}</strong>
        </div>
        <div style="display:flex;align-items:center;gap:.5rem;flex-wrap:wrap">
          <strong>${p.market}</strong>
          <span class="pill conf">Confidence ${p.confidencePct}%</span>
          ${odds}
        </div>
        <div class="muted-sm reasoning" style="margin-top:.5rem">${p.reasoning || ""}</div>
        ${trend}
      </div>
    `;
  }

  /* =======================
     ROI Calculator (3 inputs)
     ======================= */
  (function(){
    function fmt2(n){ return Number(n).toFixed(2); }
    function getOdds(p){ const o = Number(p?.odds); return Number.isFinite(o) ? o : null; }

    function updateCalc(){
      const card = document.getElementById('roi-calc');
      if (!card) return;

      const p1 = (LAST_FREE_PICKS || [])[0] || null;
      const p2 = (LAST_FREE_PICKS || [])[1] || null;
      const o1 = getOdds(p1);
      const o2 = getOdds(p2);

      // Hide the whole block if we have no odds at all
      if (!o1 && !o2) { card.style.display = 'none'; return; }
      card.style.display = '';

      const s1 = Math.max(0, Number(document.getElementById('stake1')?.value) || 0);
      const s2 = Math.max(0, Number(document.getElementById('stake2')?.value) || 0);
      const sp = Math.max(0, Number(document.getElementById('stakeParlay')?.value) || 0);

      const body = document.getElementById('calcBody');
      const foot = document.getElementById('calcFoot');

      function row(p, odds, stake, label){
        if (!p) {
          return `<div class="calc-row"><div class="muted-sm">${label}: pick not available.</div></div>`;
        }
        const name = `${p.home} vs ${p.away}`;
        if (odds == null) {
          return `<div class="calc-row">
            <div>
              <strong>${name}</strong>
              <div class="muted-sm">${p.market || ''} — <em>odds unavailable</em></div>
            </div>
            <div class="muted-sm">Enter odds to see return</div>
          </div>`;
        }
        const ret = stake * odds;
        const prof = ret - stake;
        return `<div class="calc-row">
          <div>
            <strong>${name}</strong>
            <div class="muted-sm">${p.market || ''}${p.selection ? (' — ' + p.selection) : ''} @ ${fmt2(odds)}</div>
          </div>
          <div>
            <span class="pill">Return: ${fmt2(ret)}</span>
            <span class="pill">Profit: ${fmt2(prof)}</span>
          </div>
        </div>`;
      }

      // Singles section
      let html = '';
      html += `<h3 class="muted-sm" style="margin:.15rem 0">Singles</h3>`;
      html += row(p1, o1, s1, 'Single #1');
      html += row(p2, o2, s2, 'Single #2');

      // Parlay section
      html += `<h3 class="muted-sm" style="margin:.6rem 0 .15rem">Parlay</h3>`;
      if (o1 != null && o2 != null) {
        const parOdds = o1 * o2;
        const ret = sp * parOdds;
        const prof = ret - sp;
        html += `<div class="calc-row">
          <div>
            <strong>Two-leg parlay</strong>
            <div class="muted-sm">${(p1?.market||'')} @ ${fmt2(o1)} + ${(p2?.market||'')} @ ${fmt2(o2)} → <strong>${fmt2(parOdds)}</strong></div>
          </div>
          <div>
            <span class="pill">Return: ${fmt2(ret)}</span>
            <span class="pill">Profit: ${fmt2(prof)}</span>
          </div>
        </div>`;
      } else {
        html += `<div class="calc-row"><div class="muted-sm">Parlay unavailable (need odds for both picks).</div></div>`;
      }

      body.innerHTML = html;

      // Totals (sum of all entered stakes; returns from available odds)
      const totStake = s1 + s2 + sp;

      let totReturn = 0, totProfit = 0;
      if (o1 != null) { totReturn += s1 * o1; totProfit += s1 * (o1 - 1); }
      if (o2 != null) { totReturn += s2 * o2; totProfit += s2 * (o2 - 1); }
      if (o1 != null && o2 != null) {
        const par = o1 * o2;
        totReturn += sp * par;
        totProfit += sp * (par - 1);
      }
      const roi = totStake > 0 ? (totProfit / totStake) * 100 : 0;

      foot.innerHTML =
        `<span class="pill">Total stake: ${fmt2(totStake)}</span>
         <span class="pill">Potential return: ${fmt2(totReturn)}</span>
         <span class="pill">Potential profit: ${fmt2(totProfit)}</span>
         <span class="pill">ROI: ${roi.toFixed(1)}%</span>`;
    }

    // expose + bind inputs
    window.__refreshCalc = updateCalc;
    ['stake1','stake2','stakeParlay'].forEach(id=>{
      const el = document.getElementById(id);
      if (el) el.addEventListener('input', updateCalc);
    });
    document.getElementById('stakeReset')?.addEventListener('click', ()=>{
      const s1 = document.getElementById('stake1');
      const s2 = document.getElementById('stake2');
      const sp = document.getElementById('stakeParlay');
      if (s1) s1.value = 1;
      if (s2) s2.value = 1;
      if (sp) sp.value = 1;
      updateCalc();
    });
  })();
  /* ===== /calculator ===== */

  async function loadPicks(){
    const tgt = document.getElementById('list');
    try{
      tgt.textContent = "Loading…";
      const url = `/api/rpc?action=free-picks&tz=${encodeURIComponent(tzGuess())}`;
      const res = await fetch(url);
      const data = await res.json();
      const picks = Array.isArray(data?.picks) ? data.picks : [];
      LAST_FREE_PICKS = picks;

      if(!picks.length){
        tgt.innerHTML = `<p class="muted">No confident picks available yet today.</p>`;
        document.getElementById('roi-calc').style.display = 'none';
        return;
      }
      tgt.innerHTML = picks.map(pickCard).join("");

      // recalc calculator now that picks are in
      if (typeof window.__refreshCalc === 'function') window.__refreshCalc();
    }catch{
      document.getElementById('list').innerHTML = "<p>Could not load free picks.</p>";
      document.getElementById('roi-calc').style.display = 'none';
    }
  }

  document.getElementById('exportFree').addEventListener('click', () => {
    try{
      const txt = window.OE_BetSlip.fromFreePicks(LAST_FREE_PICKS || []);
      window.OE_BetSlip.copyToClipboard(txt);
    }catch{ alert('Nothing to export yet.'); }
  });

  loadPicks();
</script>

<!-- Shared navbar auth module -->
<script type="module" src="/auth.js"></script>

</body>
</html>
