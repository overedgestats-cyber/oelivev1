<!doctype html>
<html lang="en">
  <!-- Meta Pixel Code -->
<script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '1135930111808538');
fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=1135930111808538&ev=PageView&noscript=1"
/></noscript>
<!-- End Meta Pixel Code -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Free Picks · OverEdge</title>
  <meta name="description" content="Two highest-confidence Over/Under 2.5 Goals selections each day."/>
  <link rel="stylesheet" href="/style.css"/>

  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/overedge-logo-512.png">

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-88C4MQ3EF8"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-88C4MQ3EF8');
  </script>

  <!-- Minimal styles for ROI block (uses your existing tokens/components) -->
  <style>
    #roiCalc .row{display:flex;gap:.6rem;align-items:center;flex-wrap:wrap;margin:.35rem 0 .75rem}
    #roiCalc input[type="number"]{
      padding:.45rem .6rem;border:1px solid var(--line);border-radius:8px;background:#0b1120;color:var(--text);min-width:120px
    }
  </style>
</head>
<script defer src="/_vercel/speed-insights/script.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  try{ fbq('track','ViewContent',{content_category:'free_picks'}); }catch(e){}
});
</script>
<script> if (typeof fbq==='function') fbq('track','ViewContent',{content_name:'Free Picks'}); </script>
<script src="/pixel.js" defer></script>
<script src="/social.js" defer></script>
<script src="/betslip.js" defer></script>

<body>
<header class="site-header">
  <nav class="nav">
    <a class="logo brand" href="/" aria-label="OverEdge">
      <img class="brand-img" src="/img/overedge-logo.png" alt="">
      <span class="sr-only">OverEdge</span>
    </a>
    <div class="links">
      <a href="/free-picks" aria-current="page">Free Picks</a>
      <a href="/pro">Pro</a>
      <a href="/pricing">Pricing</a>
      <a href="/FAQ">FAQ</a>
      <a href="/results">Results</a>
      <a href="/account">Account</a>
    </div>
    <div class="auth" style="display:flex;align-items:center;gap:.5rem">
      <span id="nav-plan" class="badge pill" style="display:none"></span>
      <a class="btn small secondary" href="/account">Sign In</a>
    </div>
  </nav>
</header>

<main>
  <section class="section">
    <h1 style="display:flex;align-items:center;justify-content:space-between;gap:.5rem;flex-wrap:wrap">
      Today’s Free Picks
      <button id="exportFree" class="btn small" type="button">Copy Bet Slip</button>
    </h1>
    <p class="muted">Updated daily. We post the two highest-confidence Over/Under 2.5 selections — backed by precise research and data, not gut.</p>

    <div id="list">Loading…</div>

    <!-- Potential Winnings / ROI Calculator (Free Picks) -->
    <section class="card" id="roiCalc" style="margin-top:12px; display:none">
      <h2 style="margin:0 0 .35rem">Potential Winnings</h2>
      <p class="muted-sm" id="roiCalcNote">Based on today’s free picks (odds required).</p>

      <div class="row">
        <label><strong>Stake</strong></label>
        <input type="number" id="roiStake" step="0.1" min="0" value="1">
      </div>

      <div id="roiSingles" style="margin:.5rem 0 1rem"></div>

      <div id="roiParlay" class="pill" style="display:none;padding:.5rem .7rem;border-radius:10px;font-weight:800"></div>

      <div id="roiTotals" style="margin-top:.6rem;display:flex;gap:.5rem;flex-wrap:wrap">
        <span class="pill">Total stake: <strong id="roiStakeSum">—</strong></span>
        <span class="pill">Potential return: <strong id="roiReturn">—</strong></span>
        <span class="pill">Potential profit: <strong id="roiProfit">—</strong></span>
        <span class="pill">ROI: <strong id="roiROI">—</strong></span>
      </div>
    </section>
  </section>
</main>

<footer class="site-footer">
  <span>© <span id="y"></span> OverEdge — Data beats gut</span>
  <div class="contact">
    <a href="mailto:overedgestats@gmail.com">overedgestats@gmail.com</a>
    &nbsp;·&nbsp;
    <a href="https://www.facebook.com/profile.php?id=61579190114778" target="_blank" rel="noopener">Facebook</a>
    &nbsp;·&nbsp;
    <a href="https://www.instagram.com/overedgefootball" target="_blank" rel="noopener">@overedgefootball</a>
  </div>
</footer>

<script>
  document.getElementById('y').textContent = new Date().getFullYear();

  // keep last loaded picks for export
  let LAST_FREE_PICKS = [];

  function tzGuess(){
    try { return Intl.DateTimeFormat().resolvedOptions().timeZone || "Europe/Sofia"; }
    catch { return "Europe/Sofia"; }
  }

  function pickCard(p){
    const league = [p.country, p.league].filter(Boolean).join(" — ");
    const pickClass = (p.market || "").toLowerCase().startsWith("over") ? "over" : "under";
    const odds = (p.odds && !isNaN(Number(p.odds))) ? `<span class="badge odds">Odds ${Number(p.odds).toFixed(2)}</span>` : "";
    const trend = p.trend ? `<div class="muted-sm" style="margin-top:.25rem"><strong>Trend:</strong> ${p.trend}</div>` : "";

    return `
      <div class="pick-card ${pickClass}">
        <div class="league-line">${league}</div>
        <div class="muted-sm" style="margin:.15rem 0 .35rem">
          ${p.matchTime} — <strong>${p.home}</strong> vs <strong>${p.away}</strong>
        </div>
        <div style="display:flex;align-items:center;gap:.5rem;flex-wrap:wrap">
          <strong>${p.market}</strong>
          <span class="pill conf">Confidence ${p.confidencePct}%</span>
          ${odds}
        </div>
        <div class="muted-sm reasoning" style="margin-top:.5rem">${p.reasoning || ""}</div>
        ${trend}
      </div>
    `;
  }

  // ===== ROI Calculator =====
  (function(){
    const $ = (id) => document.getElementById(id);
    const fmt = (n) => Number.isFinite(n) ? n.toFixed(2) : '—';

    window.__initFreePicksROICalc = function initFreePicksROICalc(picks){
      const withOdds = (Array.isArray(picks) ? picks : []).filter(p => Number.isFinite(Number(p.odds)));
      const host = $('roiCalc');
      if (!host) return;

      if (!withOdds.length) {
        host.style.display = 'none';
        return;
      }
      host.style.display = '';

      const singlesEl = $('roiSingles');
      const parlayEl  = $('roiParlay');
      const stakeIn   = $('roiStake');
      const stakeSum  = $('roiStakeSum');
      const retEl     = $('roiReturn');
      const profEl    = $('roiProfit');
      const roiEl     = $('roiROI');

      function compute(){
        const stake = Math.max(0, Number(stakeIn.value) || 0);

        // Singles
        const singleRows = withOdds.map(p => {
          const name = [p.home, p.away].filter(Boolean).join(' vs ');
          const odds = Number(p.odds);
          const ret  = stake * odds;
          const prof = ret - stake;
          return `
            <div class="card" style="padding:.6rem .7rem;border-radius:10px;margin:.3rem 0">
              <div style="font-weight:700">${name}</div>
              <div class="muted-sm">${p.market || ''}${p.selection ? (' — ' + p.selection) : ''} @ ${fmt(odds)}</div>
              <div class="muted-sm">Stake: ${fmt(stake)} · Return: <strong>${fmt(ret)}</strong> · Profit: <strong>${fmt(prof)}</strong></div>
            </div>
          `;
        }).join('');
        singlesEl.innerHTML = singleRows;

        // Singles totals (placing both singles)
        const singlesStake  = stake * withOdds.length;
        const singlesReturn = withOdds.reduce((s,p)=> s + stake * Number(p.odds), 0);
        const singlesProfit = singlesReturn - singlesStake;

        // 2-leg parlay (if 2+ picks)
        if (withOdds.length >= 2) {
          const comboOdds = withOdds.reduce((m,p)=> m * Number(p.odds), 1);
          const parlayStake = stake;
          const parlayReturn = stake * comboOdds;
          const parlayProfit = parlayReturn - parlayStake;
          parlayEl.style.display = '';
          parlayEl.innerHTML = `Two-leg parlay @ <strong>${fmt(comboOdds)}</strong> — Stake: ${fmt(parlayStake)} · Return: <strong>${fmt(parlayReturn)}</strong> · Profit: <strong>${fmt(parlayProfit)}</strong>`;
        } else {
          parlayEl.style.display = 'none';
        }

        // Totals = singles total (clear & conservative)
        const totStake  = singlesStake;
        const totReturn = singlesReturn;
        const totProfit = singlesProfit;
        const totROI    = totStake ? (totProfit / totStake) * 100 : 0;

        stakeSum.textContent = fmt(totStake);
        retEl.textContent    = fmt(totReturn);
        profEl.textContent   = fmt(totProfit);
        roiEl.textContent    = (Number.isFinite(totROI) ? totROI.toFixed(1) : '—') + '%';
      }

      stakeIn.addEventListener('input', compute);
      compute();
    };
  })();
  // ===== /ROI Calculator =====

  async function loadPicks(){
    const tgt = document.getElementById('list');
    try{
      tgt.textContent = "Loading…";
      const url = `/api/rpc?action=free-picks&tz=${encodeURIComponent(tzGuess())}`;
      const res = await fetch(url);
      const data = await res.json();
      const picks = Array.isArray(data?.picks) ? data.picks : [];
      LAST_FREE_PICKS = picks; // save for export
      if(!picks.length){
        tgt.innerHTML = `<p class="muted">No confident picks available yet today.</p>`;
        // hide ROI calc if no picks/odds
        if (window.__initFreePicksROICalc) __initFreePicksROICalc([]);
        return;
      }
      tgt.innerHTML = picks.map(pickCard).join("");
      // initialize ROI calc with today’s picks
      if (window.__initFreePicksROICalc) __initFreePicksROICalc(picks);
    }catch{
      document.getElementById('list').innerHTML = "<p>Could not load free picks.</p>";
      if (window.__initFreePicksROICalc) __initFreePicksROICalc([]);
    }
  }

  document.getElementById('exportFree').addEventListener('click', () => {
    try{
      const txt = window.OE_BetSlip.fromFreePicks(LAST_FREE_PICKS || []);
      window.OE_BetSlip.copyToClipboard(txt);
    }catch{ alert('Nothing to export yet.'); }
  });

  loadPicks();
</script>

<!-- Shared navbar auth module -->
<script type="module" src="/auth.js"></script>

</body>
</html>
